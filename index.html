<!DOCTYPE html>
<html>
    <head>
        <title>RotatingViruses</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <script src="phaser.min.js"></script>
                
    </head>
<body>
        
<div id="top">hejdiv</div>

<script>

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
    
function preload() {
    game.load.image('virus', 'LittleVirus.jpg');
    game.load.image('horizontal_wall', 'sprites/horizontal_wall.png');
    game.load.image('vertical_wall', 'sprites/vertical_wall.png');
}

var viruses;
var info_text;
var click_count;
var count_text;
var spawning_button;

function create() {
    
    viruses = game.add.group();
    viruses.enableBody = true;
    game.physics.enable(viruses, Phaser.Physics.ARCADE);
    //game.physics.enable(viruses, Phaser.Physics.ARCADE);
    //viruses.body.
    for (var i = 0; i <= 3; i++) {
        var virus = viruses.create(i * 100 + 100, i * 100, 'virus');
        virus.anchor.setTo(0.5, 0.5);
        virus.inputEnabled = true;
        virus.rotation_speed = 2 * Math.random() - 1;
        virus.body.velocity.x = 300 * Math.random() - 150;
        virus.body.velocity.y = 300 * Math.random() - 150;
        virus.body.collideWorldBounds = true;
        virus.body.bounce.set(1);    
    }

    info_text = game.add.text(600,550, 'CLICK US :)', 
        {fontSize: '32px', fill: '#ffa'});
    count_text = game.add.text(600,450, 'CLICK US :)', 
        {fontSize: '32px', fill: '#ffa'});
        
    walls = game.add.group();
    walls.enableBody = true;
    game.physics.enable(walls, Phaser.Physics.ARCADE);
    spawning_button = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)
    click_count = 0;
}

function update() {
    
    viruses.forEach(function(virus){
       virus.angle += virus.rotation_speed;
       virus.events.onInputDown.add(onDown, this);
    });
    
    this.game.physics.arcade.collide(viruses, walls, null, null, this);
    count_text.text = click_count;
    
    if (spawning_button.isDown && click_count >= 10){
        spawnViruses(200, 200);
        click_count -= 10;
    }
        
}

function onDown(sprite, pointer) {
    sprite.rotation_speed *= 1.5;
    sprite.body.velocity.x *= 1.2;
    sprite.body.velocity.y *= 1.2;
    click_count += 1;
    console.log(click_count);
    
}
function spawnViruses(xpos, ypos){
    var virus = viruses.create(xpos, ypos, 'virus');
    virus.anchor.setTo(0.5, 0.5);
    virus.inputEnabled = true;
    virus.rotation_speed = 2 * Math.random() - 1;
    virus.body.velocity.x = 300 * Math.random() - 150;
    virus.body.velocity.y = 300 * Math.random() - 150;
    virus.body.collideWorldBounds = true;
    virus.body.bounce.set(1);
}




</script>


</body>
</html>
