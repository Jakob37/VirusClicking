<!DOCTYPE html>
<html>
    <head>
        <title>RotatingViruses</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <script src="phaser.min.js"></script>
                
    </head>
<body>
        
<div id="top">hejdiv</div>

<script>

var game = new Phaser.Game(1200, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
    
function preload() {
    game.load.image('virus', 'LittleVirus.jpg');
    game.load.image('button', 'Plus.jpg');
    game.load.image('small_virus', 'sprites/LittleVirus_small.png');
    game.load.image('horizontal_wall', 'sprites/horizontal_wall.png');
    game.load.image('vertical_wall', 'sprites/vertical_wall.png');
}

var viruses;
var info_text;
var click_count;
var count_text;
var spawning_button;

function create() {
    
    viruses = game.add.group();
    viruses.enableBody = true;
    game.physics.enable(viruses, Phaser.Physics.ARCADE);
    for (var i = 0; i <= 3; i++) {
        spawnViruses(i * 100 + 100, i * 100);
    }
    
    game.add.button(950, 200, 'button', spawnViruses);
    
    click_count = 0;

    info_text = game.add.text(600,550, 'CLICK US :)', 
        {fontSize: '32px', fill: '#ffa'});
    count_text = game.add.text(600,450, 'CLICK US :)', 
        {fontSize: '32px', fill: '#ffa'});

    spawning_button = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    createWalls();
}

function createWalls() {
    
    walls = game.add.group();
    walls.enableBody = true;


    var wall_width = 7;

    var w1 = walls.create(-wall_width, 0, 'vertical_wall');
    var w2 = walls.create(game.width - 400, 0, 'vertical_wall');
    var w3 = walls.create(0, -wall_width, 'horizontal_wall');
    var w4 = walls.create(0, game.height, 'horizontal_wall');

    w1.body.immovable = true;
    w2.body.immovable = true;
    w3.body.immovable = true;
    w4.body.immovable = true;
}

function update() {
    
    viruses.forEach(function(virus){
       virus.angle += virus.rotation_speed;
       virus.events.onInputDown.add(onDown, this);
    });
    
    this.game.physics.arcade.collide(viruses, walls, collidesWall, null, this);
    count_text.text = click_count;
    
    if (spawning_button.isDown && click_count >= 100){
        spawnViruses();
        click_count -= 100;
    }
}

function collidesWall(virus, wall) {
    click_count += 1;
}

function onDown(sprite, pointer) {
    sprite.rotation_speed *= 1.5;
    sprite.body.velocity.x *= 1.2;
    sprite.body.velocity.y *= 1.2;
    //click_count += 1;
    console.log(click_count);
    
}
function spawnViruses(){

    var X = 600 * Math.random() + 100;
    var Y = 400 * Math.random() + 100;
        
    var virus = viruses.create(X, Y, 'small_virus');

    virus.anchor.setTo(0.5, 0.5);
    virus.inputEnabled = true;
    virus.rotation_speed = 2 * Math.random() - 1;
    virus.body.velocity.x = 300 * Math.random() - 150;
    virus.body.velocity.y = 300 * Math.random() - 150;
    virus.body.bounce.set(1);
}




</script>


</body>
</html>
